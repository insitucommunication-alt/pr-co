<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Cockpit DSI 2026 – Connect Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --maif-red: #d32f2f;
            --bg-neutral: #f8fafc;
            --border-color: #e2e8f0;
            --text-main: #1e293b;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-neutral);
            color: var(--text-main);
            -webkit-font-smoothing: antialiased;
        }

        .glass-card {
            background: white;
            border: 1px solid var(--border-color);
            min-height: 165px;
            display: flex;
            flex-direction: column;
            padding: 1.5rem;
            border-radius: 12px;
            transition: all 0.2s ease;
            cursor: pointer;
            position: relative;
        }
        .glass-card:hover {
            border-color: var(--maif-red);
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            transform: translateY(-3px);
        }

        .axe-label {
            font-size: 9px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--maif-red);
        }

        .precon-id {
            font-size: 10px;
            font-weight: 900;
            color: #94a3b8;
        }

        .pilot-link {
            font-weight: 700;
            color: #475569;
            text-decoration: underline;
            text-underline-offset: 3px;
            text-decoration-color: #cbd5e1;
            transition: all 0.2s;
            z-index: 10;
            font-size: 11px;
        }
        .pilot-link:hover {
            color: var(--maif-red);
            text-decoration-color: var(--maif-red);
        }

        .progress-track {
            height: 6px;
            background-color: #f1f5f9;
            width: 100%;
            border-radius: 4px;
            margin-top: 8px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background-color: var(--maif-red);
            border-radius: 4px;
            transition: width 0.5s ease-out;
        }

        .header-blur {
            backdrop-filter: blur(12px);
            background: rgba(255, 255, 255, 0.95);
            border-bottom: 1px solid var(--border-color);
        }

        .nav-link {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            padding-bottom: 4px;
            border-bottom: 2px solid transparent;
            color: #94a3b8;
            letter-spacing: 0.05em;
        }
        .nav-link.active {
            color: var(--maif-red);
            border-bottom-color: var(--maif-red);
        }

        .axe-filter-btn {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            color: #64748b;
            letter-spacing: 0.02em;
        }
        .axe-filter-btn.active { color: var(--maif-red); font-weight: 800; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;  
            overflow: hidden;
        }
    </style>
</head>
<body>

    <header class="header-blur sticky top-0 z-50 px-8 py-4">
        <div class="max-w-[1600px] mx-auto flex items-center justify-between">
            <div class="flex items-center gap-4">
                <div class="w-9 h-9 bg-black text-white flex items-center justify-center rounded-lg text-sm font-black italic">M</div>
                <div>
                    <h1 class="text-lg font-light tracking-tight leading-none uppercase">Transfo<span class="text-[#d32f2f] font-bold italic">2026</span></h1>
                    <p class="text-[9px] uppercase tracking-[0.2em] text-gray-400 mt-1 font-bold">Cockpit DSI Connect</p>
                </div>
            </div>

            <nav class="hidden md:flex gap-10">
                <button onclick="switchView('grid')" id="btn-grid" class="nav-link active">Bourse aux leviers</button>
                <button onclick="switchView('piste')" id="btn-piste" class="nav-link">Dynamique Agile</button>
            </nav>

            <div class="flex items-center gap-4">
                <button onclick="downloadApp()" class="text-[10px] font-bold uppercase bg-slate-100 px-4 py-2 rounded-full hover:bg-slate-200 transition-all mr-2">Télécharger .html</button>
                <input id="mainSearch" oninput="filterAll()" type="text" placeholder="Rechercher..." class="bg-gray-50 border border-gray-200 rounded-full px-5 py-1.5 text-xs w-56 focus:ring-1 focus:ring-red-600 outline-none transition-all">
                <div class="w-8 h-8 rounded-full bg-slate-200 border border-white flex items-center justify-center text-[10px] font-bold">JD</div>
            </div>
        </div>
    </header>

    <main class="max-w-[1600px] mx-auto p-8">
        
        <div class="flex flex-col xl:flex-row justify-between items-center mb-8 gap-6 border-b border-gray-100 pb-6">
            <div class="flex gap-6 items-center w-full xl:w-auto overflow-hidden">
                <h2 class="text-xl font-bold text-slate-800 italic whitespace-nowrap">Portfolio <span class="text-red-600" id="count-display">39 leviers</span></h2>
                <div class="h-6 w-[1px] bg-slate-200 hidden sm:block"></div>
                <div id="pilotsList" class="flex gap-4 overflow-x-auto no-scrollbar items-center">
                    <!-- Généré par JS -->
                </div>
            </div>
            <div class="flex gap-6 overflow-x-auto w-full xl:w-auto justify-start xl:justify-end no-scrollbar" id="axe-filters">
                <button class="axe-filter-btn active whitespace-nowrap" onclick="filterByAxe('all')">Tous</button>
                <button class="axe-filter-btn whitespace-nowrap" onclick="filterByAxe(1)">Fondamentaux</button>
                <button class="axe-filter-btn whitespace-nowrap" onclick="filterByAxe(2)">La communauté m'aide</button>
                <button class="axe-filter-btn whitespace-nowrap" onclick="filterByAxe(3)">J'aide la communauté</button>
                <button class="axe-filter-btn whitespace-nowrap" onclick="filterByAxe(4)">Collectifs</button>
            </div>
        </div>

        <!-- GRID VIEW -->
        <section id="view-grid">
            <div id="projectsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                <!-- Généré par JS -->
            </div>
        </section>

        <!-- PISTE VIEW -->
        <section id="view-piste" class="hidden">
            <div id="pistesContainer" class="space-y-8">
                <!-- Généré par JS -->
            </div>
        </section>
    </main>

    <!-- Modal de Détail -->
    <div id="backdrop" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[100] hidden items-center justify-center p-4" onclick="if(event.target===this) closeModal()">
        <div class="bg-white max-w-xl w-full p-10 shadow-2xl rounded-2xl border border-gray-100 animate-in fade-in zoom-in duration-200">
            <div class="flex justify-between items-start mb-8">
                <div class="pr-6">
                    <span id="mAxe" class="text-[10px] uppercase tracking-widest text-red-600 font-black italic">AXE</span>
                    <h3 id="mTitle" class="text-2xl font-bold mt-2 leading-tight text-gray-900">Titre</h3>
                </div>
                <button onclick="closeModal()" class="text-gray-400 hover:text-black p-2 text-xl">✕</button>
            </div>

            <div class="flex items-center justify-between bg-slate-50 p-5 rounded-xl mb-8">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-white border border-slate-200 rounded-lg flex items-center justify-center text-sm font-bold text-slate-400" id="mAvatar">--</div>
                    <div>
                        <span class="text-[9px] uppercase text-gray-400 font-black block mb-1">Responsable</span>
                        <span id="mPilot" class="text-base font-bold text-slate-800">NOM PORTEUR</span>
                    </div>
                </div>
                <button id="mContactBtn" class="bg-black text-white px-5 py-2.5 rounded-lg text-[10px] font-black uppercase tracking-wider hover:bg-red-600 transition-colors">
                    Envoyer un message
                </button>
            </div>

            <p id="mDesc" class="text-base text-gray-500 leading-relaxed mb-8">Description...</p>

            <div class="border-t border-gray-100 pt-8">
                <div class="flex justify-between items-end mb-5">
                    <span class="text-[10px] uppercase font-black text-gray-400">Progression Actuelle</span>
                    <span id="mProgressText" class="text-3xl font-black text-red-600 italic">0%</span>
                </div>
                <input id="mSlider" type="range" min="0" max="100" class="w-full accent-[#d32f2f] h-2 bg-gray-100 rounded-lg appearance-none cursor-pointer" oninput="updateModalProgress(this.value)">
            </div>

            <button onclick="saveProgress()" class="w-full bg-red-600 text-white py-4 mt-8 rounded-xl text-xs font-bold uppercase tracking-[0.2em] hover:bg-red-700 transition-all shadow-lg">Enregistrer les modifications</button>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'dsi_cockpit_data_v1';
        const axeLabels = ["", "Fondamentaux", "La communauté m'aide", "J'aide la communauté", "Collectifs"];
        const pilotsNames = ["David P.", "Anne D.", "Vanessa G.", "Sylvie Z.", "Marc L.", "Kevin M.", "Isabelle R.", "Julien C.", "Arthur C.", "Angélique B."];
        
        let projects = [];
        let filterAxe = 'all';
        let filterPilot = 'all';
        let activeId = null;

        // --- GESTION DES DONNÉES ---

        function initData() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                projects = JSON.parse(saved);
            } else {
                // Génération initiale
                for(let i=1; i<=39; i++) {
                    const axeIdx = (i % 4) + 1;
                    projects.push({
                        id: i,
                        axe: axeIdx,
                        title: getInitialTitle(i),
                        pilot: pilotsNames[i % pilotsNames.length],
                        progress: Math.floor(Math.random() * 40), // Progression de départ aléatoire
                        desc: getInitialDesc(i)
                    });
                }
                saveToStorage();
            }
        }

        function saveToStorage() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(projects));
        }

        function getInitialTitle(i) {
            const titles = ["Cartographie compétences", "Standard Knowledge", "Reporting JIRA", "Portail Roadmap", "Synergie Métier", "Socle DevOps", "Observabilité", "Gouvernance Data", "Culture FinOps"];
            return titles[i % titles.length] + " (Préco #" + String(i).padStart(2, '0') + ")";
        }

        function getInitialDesc(i) {
            return "Action stratégique n°" + i + " visant à renforcer l'efficacité opérationnelle et la fluidité des échanges au sein de la DSI pour la trajectoire 2026.";
        }

        // --- NAVIGATION & FILTRES ---

        function switchView(view) {
            document.getElementById('view-grid').classList.toggle('hidden', view !== 'grid');
            document.getElementById('view-piste').classList.toggle('hidden', view !== 'piste');
            document.getElementById('btn-grid').classList.toggle('active', view === 'grid');
            document.getElementById('btn-piste').classList.toggle('active', view === 'piste');
        }

        function setPilotFilter(p) {
            filterPilot = p;
            renderPilots();
            filterAll();
        }

        function filterByAxe(axe) {
            filterAxe = axe;
            document.querySelectorAll('.axe-filter-btn').forEach((btn, idx) => {
                btn.classList.toggle('active', (axe === 'all' && idx === 0) || (axe == idx));
            });
            filterAll();
        }

        function filterAll() {
            const search = document.getElementById('mainSearch').value.toLowerCase();
            const filtered = projects.filter(p => {
                const mAxe = filterAxe === 'all' || p.axe == filterAxe;
                const mPilot = filterPilot === 'all' || p.pilot == filterPilot;
                const mSearch = p.title.toLowerCase().includes(search) || p.pilot.toLowerCase().includes(search);
                return mAxe && mPilot && mSearch;
            });
            document.getElementById('count-display').textContent = `${filtered.length} levier${filtered.length > 1 ? 's' : ''}`;
            renderGrid(filtered);
            renderPistes(filtered);
        }

        // --- RENDU UI ---

        function renderPilots() {
            const container = document.getElementById('pilotsList');
            const uniq = [...new Set(projects.map(p => p.pilot))].sort();
            container.innerHTML = `<button onclick="setPilotFilter('all')" class="text-[10px] font-bold uppercase transition-colors ${filterPilot === 'all' ? 'text-red-600 underline underline-offset-4' : 'text-slate-400'}">Tous</button>`;
            uniq.forEach(p => {
                container.innerHTML += `<button onclick="setPilotFilter('${p}')" class="text-[10px] font-bold uppercase whitespace-nowrap transition-colors ${filterPilot === p ? 'text-red-600 underline underline-offset-4' : 'text-slate-400'}">${p}</button>`;
            });
        }

        function renderGrid(data) {
            const grid = document.getElementById('projectsGrid');
            grid.innerHTML = "";
            data.forEach(p => {
                grid.innerHTML += `
                    <div class="glass-card" onclick="if(!event.target.closest('.pilot-link')) openModal(${p.id})">
                        <div class="flex justify-between items-start mb-4">
                            <span class="axe-label">${axeLabels[p.axe]}</span>
                            <span class="precon-id">#${String(p.id).padStart(2, '0')}</span>
                        </div>
                        <h3 class="text-sm font-bold leading-tight text-slate-900 mb-2 line-clamp-2 h-10 italic">${p.title}</h3>
                        <p class="text-xs text-slate-500 line-clamp-2 mb-6">${p.desc}</p>
                        <div class="mt-auto">
                            <div class="flex justify-between items-end mb-2">
                                <span class="pilot-link" onclick="contactPilot('${p.pilot}', '${p.title}')">${p.pilot}</span>
                                <span class="text-xs font-black italic">${p.progress}%</span>
                            </div>
                            <div class="progress-track">
                                <div class="progress-fill" style="width: ${p.progress}%"></div>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        function renderPistes(data) {
            const container = document.getElementById('pistesContainer');
            container.innerHTML = "";
            for(let i=1; i<=4; i++) {
                container.innerHTML += `
                    <div class="bg-white border border-gray-100 p-8 rounded-xl">
                        <span class="text-[10px] font-black uppercase tracking-widest text-gray-400 italic mb-6 block">${axeLabels[i]}</span>
                        <div class="relative h-16 flex items-center">
                            <div class="absolute inset-x-0 h-[2px] bg-slate-50"></div>
                            <div id="track-${i}" class="relative w-full h-full"></div>
                        </div>
                    </div>
                `;
                const track = document.getElementById(`track-${i}`);
                data.filter(p => p.axe === i).forEach(p => {
                    const jitter = ((p.id * 17) % 30) - 15;
                    const pion = document.createElement('div');
                    pion.style.cssText = `
                        width: 28px; height: 28px; background: white; border: 2px solid var(--maif-red);
                        font-size: 10px; font-weight: 800; display: grid; place-items: center;
                        border-radius: 8px; position: absolute; cursor: pointer;
                        left: ${p.progress}%; top: calc(50% + ${jitter}px); transform: translate(-50%, -50%);
                        box-shadow: 0 4px 10px rgba(211, 47, 47, 0.2); transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                    `;
                    pion.innerHTML = p.id;
                    pion.onclick = () => openModal(p.id);
                    pion.onmouseenter = () => pion.style.transform = 'translate(-50%, -50%) scale(1.3) rotate(5deg)';
                    pion.onmouseleave = () => pion.style.transform = 'translate(-50%, -50%) scale(1) rotate(0deg)';
                    track.appendChild(pion);
                });
            }
        }

        // --- MODAL & ACTIONS ---

        function openModal(id) {
            activeId = id;
            const p = projects.find(x => x.id === id);
            document.getElementById('mTitle').textContent = p.title;
            document.getElementById('mAxe').textContent = `AXE ${p.axe} : ${axeLabels[p.axe]}`;
            document.getElementById('mPilot').textContent = p.pilot;
            document.getElementById('mAvatar').textContent = p.pilot.split(' ').map(n=>n[0]).join('');
            document.getElementById('mDesc').textContent = p.desc;
            document.getElementById('mSlider').value = p.progress;
            updateModalProgress(p.progress);
            document.getElementById('backdrop').classList.replace('hidden', 'flex');
        }

        function closeModal() {
            document.getElementById('backdrop').classList.replace('flex', 'hidden');
        }

        function updateModalProgress(val) {
            document.getElementById('mProgressText').textContent = `${val}%`;
        }

        function saveProgress() {
            const p = projects.find(x => x.id === activeId);
            p.progress = parseInt(document.getElementById('mSlider').value);
            saveToStorage();
            filterAll();
            closeModal();
        }

        function contactPilot(name, title) {
            const email = name.toLowerCase().replace(' ', '.') + "@maif.fr";
            window.location.href = `mailto:${email}?subject=Levier Transfo: ${title}`;
        }

        function downloadApp() {
            const htmlContent = document.documentElement.outerHTML;
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'cockpit_dsi_2026.html';
            a.click();
        }

        window.onload = () => {
            initData();
            renderPilots();
            filterAll();
        };
    </script>
</body>
</html>
